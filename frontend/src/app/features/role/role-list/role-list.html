<div class="page-wrap">
  <h1 class="page-title gradient-text">Roles</h1>

  <div class="app-card with-accent">
    <div class="card-header">
      <button class="back-btn" type="button" (click)="goBack()" aria-label="Back">
        <svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6" />
        </svg>
        <span>Back</span>
      </button>
      <div class="header-actions">
        <button class="btn--ghost" type="button" (click)="goCreate()">Create New Role</button>
      </div>
    </div>

    <div class="alert alert-success" *ngIf="success()" aria-live="polite">
      <span class="alert__icon" aria-hidden="true">
        <svg viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10"/>
          <path d="M8 12l3 3 6-6"/>
        </svg>
      </span>
      {{ success() }}
    </div>
    <div class="alert alert-error" *ngIf="error()" aria-live="assertive">
      <span class="alert__icon" aria-hidden="true">
        <svg viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10"/>
          <line x1="15" y1="9" x2="9" y2="15"/>
          <line x1="9" y1="9" x2="15" y2="15"/>
        </svg>
      </span>
      {{ error() }}
    </div>

    <ng-container *ngIf="!loading(); else loadingTpl">
      <div class="data-table-wrap">
        <div class="data-table">
          <div class="data-head">
            <div class="data-cell">Name</div>
            <div class="data-cell">Display Name</div>
            <div class="data-cell">System Role</div>
            <div class="data-cell">Actions</div>
          </div>

          <div class="data-row" *ngFor="let r of roles(); trackBy: trackById">
            <div class="data-cell" data-label="Name">
              <span class="truncate">{{ r.name }}</span>
            </div>
            <div class="data-cell" data-label="Display Name">
              <span class="truncate muted">{{ r.displayName || 'â€”' }}</span>
            </div>
            <div class="data-cell" data-label="System Role">
              <span class="chip" [ngClass]="r.isSystem ? 'chip--success' : 'chip--muted'">
                <span class="dot"></span>
                {{ r.isSystem ? 'System' : 'Custom' }}
              </span>
            </div>
            <div class="data-cell" data-label="Actions">
              <button class="btn--ghost btn--sm" type="button" (click)="goDetail(r._id)">Details</button>
              <button class="btn--ghost btn--sm" type="button" (click)="goEdit(r._id)" [disabled]="r.isSystem"
                [attr.title]="r.isSystem ? 'System roles cannot be edited' : null">
                Edit
              </button>
              <button class="btn--ghost btn--danger btn--sm" type="button" (click)="remove(r._id)"
                [disabled]="actionLoading() || r.isSystem"
                [attr.title]="r.isSystem ? 'System roles cannot be deleted' : null">
                Delete
              </button>
            </div>
          </div>
        </div>
      </div>

      <nav class="pagination" *ngIf="meta()" aria-label="Pagination">
        <div class="pagination-controls" *ngIf="meta()!.totalPages > 1">
          <button class="btn--ghost btn--sm" [disabled]="!hasPrev()" (click)="changePage(meta()!.page - 1)"
            type="button">Previous</button>
          <span class="page-info">Page {{ meta()!.page }} of {{ meta()!.totalPages }}</span>
          <button class="btn--ghost btn--sm" [disabled]="!hasNext()" (click)="changePage(meta()!.page + 1)"
            type="button">Next</button>
        </div>
        <div class="pagination-meta">
          <div class="meta-chip">Total: <strong>{{ meta()!.total }}</strong></div>
          <div class="meta-chip" *ngIf="meta()!.totalPages > 1">Page {{ meta()!.page }} / <strong>{{ meta()!.totalPages }}</strong></div>
        </div>
      </nav>
    </ng-container>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="app-card with-accent skeleton">
    <div class="skeleton-line wide"></div>
    <div class="skeleton-line"></div>
    <div class="skeleton-line"></div>
    <div class="skeleton-line half"></div>
  </div>
</ng-template>